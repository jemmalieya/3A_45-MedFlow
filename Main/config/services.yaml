# config/services.yaml

parameters:
    ipinfo.token: '%env(IPINFO_TOKEN)%'
    ipinfo.test_ip: '%env(default::IPINFO_TEST_IP)%'
    pieces_jointes_directory: '%kernel.project_dir%/public/uploads/pieces_jointes'
    profile_pictures_directory: '%kernel.project_dir%/public/uploads/profile'
    openfda.api_key: '%env(OPENFDA_API_KEY)%'
    openfda.timeout: '%env(int:OPENFDA_TIMEOUT)%'
    groq.api_key: '%env(GROQ_API_KEY)%'
    groq.model: '%env(GROQ_MODEL)%'
    gemini_api_key: '%env(GEMINI_API_KEY)%'

    # Public origin used for phone-scannable QR links (e.g. http://192.168.1.10:8000).
    # If empty, the frontend falls back to window.location.origin.
    app.public_origin: '%env(default::APP_PUBLIC_ORIGIN)%'

  

services:
    _defaults:
        autowire: true
        autoconfigure: true

    # Stripe
    App\Service\StripePaymentService:
        arguments:
            $stripeSecretKey: '%env(STRIPE_SECRET_KEY)%'
            $appUrl: '%env(APP_URL)%'

    # Twilio
    App\Service\TwilioSmsService:
        arguments:
            $sid: '%env(TWILIO_SID)%'
            $token: '%env(TWILIO_TOKEN)%'
            $from: '%env(TWILIO_FROM)%'

    # Auto-register services in src/
    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'

    App\Service\IpinfoClient:
        arguments:
            $ipinfoToken: '%ipinfo.token%'
            $ipinfoTestIp: '%ipinfo.test_ip%'
    # Gemini Service
    # Gemini Service
    App\Service\GeminiService:
        arguments:
            $geminiApiKey: '%gemini_api_key%'
            $geminiModel: 'gemini-2.5-flash'

    # OpenFDA (Service d'interactions m√©dicamenteuses)
    App\Service\OpenFdaService:
        arguments:
            $apiKey: '%openfda.api_key%'
            
    App\Service\GroqService:
        arguments:
            $apiKey: '%groq.api_key%'
            $model: '%groq.model%'


    mailer.transports.my:
        class: Symfony\Component\Mailer\Transport\TransportInterface
        factory: ['@mailer.transport_factory', 'fromDsn']
        arguments:
            - '%env(MY_MAILER_DSN)%'

    mailer.my:
        class: Symfony\Component\Mailer\Mailer
        arguments:
            - '@mailer.transports.my'
            
    App\Service\DialogflowService:
        arguments:
            $projectId: 'medflow-ai-assistant' # Replace with your Dialogflow project ID
            $credentialsPath: '%kernel.project_dir%/config/medflow-ai-assistant-ba2dd08bcd44.json'
