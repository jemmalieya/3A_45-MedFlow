{% extends 'base_dashboard.html.twig' %}

{% block title %}Ajouter un produit{% endblock %}

{% block body %}
<div class="container-fluid py-4 add-produit-page">
  <div class="row justify-content-center">
    <div class="col-xl-10">

      {# ====== HEADER ====== #}
      <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
        <div>
          <h2 class="mb-1 fw-bold text-dark">
            <i class="bi bi-plus-circle text-primary me-2"></i>Ajouter un produit
          </h2>
          <p class="mb-0 text-dark-50">Remplissez les informations du nouveau produit</p>
        </div>

        <a href="{{ path('admin_produits_index') }}" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left me-2"></i>Retour
        </a>
      </div>

      {# ====== FLASH (auto hide 3s) ====== #}
      <div id="flash-messages-container">
        {% for message in app.flashes('success') %}
          <div class="alert alert-success alert-dismissible fade show flash-message shadow-sm" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i>{{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}

        {% for message in app.flashes('error') %}
          <div class="alert alert-danger alert-dismissible fade show flash-message shadow-sm" role="alert">
            <i class="bi bi-x-circle-fill me-2"></i>{{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      </div>

      {# ====== FORM ====== #}
      {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}

      <div class="row g-4">

        {# ====== LEFT (infos) ====== #}
        <div class="col-lg-8">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-gradient-primary text-white py-3">
              <h5 class="mb-0 fw-bold">
                <i class="bi bi-info-circle me-2"></i>Informations principales
              </h5>
            </div>

            <div class="card-body p-4">

              <div class="mb-4">
                <label class="form-label fw-bold text-dark">
                  <i class="bi bi-tag me-2"></i>Nom du produit <span class="text-danger">*</span>
                </label>
                {{ form_widget(form.nom_produit, {'attr': {'class': 'form-control form-control-lg'}}) }}
                <div class="text-danger small mt-1">{{ form_errors(form.nom_produit) }}</div>
              </div>

              <div class="mb-4">
                <label class="form-label fw-bold text-dark">
                  <i class="bi bi-card-text me-2"></i>Description <span class="text-danger">*</span>
                </label>
                {{ form_widget(form.description_produit, {'attr': {'class': 'form-control', 'rows': 5}}) }}
                <div class="text-danger small mt-1">{{ form_errors(form.description_produit) }}</div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-4">
                  <label class="form-label fw-bold text-dark">
                    <i class="bi bi-currency-dollar me-2"></i>Prix (DT) <span class="text-danger">*</span>
                  </label>
                  <div class="input-group input-group-lg">
                    {{ form_widget(form.prix_produit, {'attr': {'class': 'form-control'}}) }}
                    <span class="input-group-text bg-success text-white">
                      <i class="bi bi-cash-coin me-1"></i>DT
                    </span>
                  </div>
                  <div class="text-danger small mt-1">{{ form_errors(form.prix_produit) }}</div>
                </div>

                <div class="col-md-6 mb-4">
                  <label class="form-label fw-bold text-dark">
                    <i class="bi bi-box-seam me-2"></i>Quantité <span class="text-danger">*</span>
                  </label>
                  {{ form_widget(form.quantite_produit, {'attr': {'class': 'form-control form-control-lg'}}) }}
                  <div class="text-danger small mt-1">{{ form_errors(form.quantite_produit) }}</div>
                </div>
              </div>

              <div class="mb-4">
                <label class="form-label fw-bold text-dark">
                  <i class="bi bi-grid me-2"></i>Catégorie <span class="text-danger">*</span>
                </label>
                {{ form_widget(form.categorie_produit, {'attr': {'class': 'form-select form-select-lg'}}) }}
                <div class="text-danger small mt-1">{{ form_errors(form.categorie_produit) }}</div>
              </div>

              <div class="mb-0">
                <label class="form-label fw-bold text-dark">
                  <i class="bi bi-image me-2"></i>URL de l'image <span class="text-danger">*</span>
                </label>
                <div class="input-group input-group-lg">
                  <span class="input-group-text bg-light">
                    <i class="bi bi-link-45deg"></i>
                  </span>
                  {{ form_widget(form.image_produit, {'attr': {'class': 'form-control'}}) }}
                </div>
                <div class="text-danger small mt-1">{{ form_errors(form.image_produit) }}</div>
              </div>

            </div>
          </div>
        </div>

        {# ====== RIGHT (status radios - Symfony) ====== #}
        <div class="col-lg-4">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-light border-0 py-3">
              <h6 class="mb-0 fw-bold text-dark">
                <i class="bi bi-toggle-on me-2"></i>Statut du produit
              </h6>
            </div>

            <div class="card-body p-4">
              <div class="status-radio-group">
                {{ form_widget(form.status_produit) }}
              </div>
              <div class="text-danger small mt-2">{{ form_errors(form.status_produit) }}</div>

              <div class="mt-3 small text-muted">
                <i class="bi bi-info-circle me-1"></i>
                Le statut contrôle l’affichage côté front.
              </div>
            </div>
          </div>
        </div>

      </div>

      {# ====== ACTIONS ====== #}
      <div class="card border-0 shadow-sm mt-4">
        <div class="card-body p-4">
          <div class="d-flex gap-3 justify-content-between align-items-center flex-wrap">
            <small class="text-muted">
              <i class="bi bi-info-circle me-1"></i>
              Les champs marqués d'un <span class="text-danger">*</span> sont obligatoires
            </small>

            <div class="d-flex gap-3">
              <a href="{{ path('admin_produits_index') }}" class="btn btn-outline-secondary btn-lg px-5">
                <i class="bi bi-x-circle me-2"></i>Annuler
              </a>

              <button type="submit" class="btn btn-primary btn-lg px-5">
                <i class="bi bi-check-circle me-2"></i>Ajouter le produit
              </button>
            </div>
          </div>
        </div>
      </div>

      {{ form_end(form) }}

    </div>
  </div>
</div>
{% endblock %}

{# ====== STYLES ====== #}
{% block stylesheets %}
  {{ parent() }}
  <style>
    .add-produit-page, .add-produit-page *{
      color:#111827;
    }
    .text-dark-50{ color:#6b7280 !important; }

    .bg-gradient-primary{
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    /* ===== Flash auto animation ===== */
    .flash-message{
      border-left: 4px solid;
      animation: slideInDown .35s ease;
    }
    .flash-message.slide-out{
      animation: slideOutUp .35s ease forwards;
    }
    @keyframes slideInDown{
      from{ opacity:0; transform: translateY(-25px); }
      to{ opacity:1; transform: translateY(0); }
    }
    @keyframes slideOutUp{
      from{ opacity:1; transform: translateY(0); }
      to{ opacity:0; transform: translateY(-25px); }
    }

    /* ===== Status radios Symfony => Cards =====
       Symfony génère: input + label, donc on style label.
    */
    .status-radio-group input[type="radio"]{
      display:none;
    }

    .status-radio-group label{
      border:1px solid #e5e7eb;
      padding:14px 14px;
      border-radius:14px;
      display:block;
      margin-bottom:12px;
      cursor:pointer;
      background:#fff;
      transition: .2s ease;
      font-weight:600;
      color:#111827 !important;
    }

    .status-radio-group label:hover{
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(0,0,0,.08);
    }

    /* ✅ Checked style */
    .status-radio-group input[type="radio"]:checked + label{
      border-color:#667eea;
      box-shadow: 0 0 0 4px rgba(102,126,234,.18);
      background: #f5f7ff;
    }

    /* Pour que les labels aient des petits détails */
    .status-radio-group label::after{
      content:"";
      float:right;
      width:10px;height:10px;
      border-radius:50%;
      background:#d1d5db;
      margin-top:6px;
    }
    .status-radio-group input[type="radio"]:checked + label::after{
      background:#667eea;
    }
  </style>
{% endblock %}

{# ====== JS ====== #}
{% block javascripts %}
  {{ parent() }}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ✅ Auto-disparition des flash après 3 sec
      document.querySelectorAll('.flash-message').forEach(msg => {
        setTimeout(() => {
          msg.classList.add('slide-out');
          setTimeout(() => msg.remove(), 350);
        }, 3000);
      });
    });
  </script>
{% endblock %}
