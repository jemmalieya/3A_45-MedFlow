{% extends 'base_dashboard.html.twig' %}
{% block title %}Demandes de participation{% endblock %}

{% block body %}
<div class="container-fluid py-4">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h3 mb-1">Demandes de participation</h1>
      <p class="text-muted mb-0">Validation des demandes par événement</p>
    </div>
  </div>

  {% for m in app.flashes('success') %}
    <div class="alert alert-success">{{ m }}</div>
  {% endfor %}
  {% for m in app.flashes('danger') %}
    <div class="alert alert-danger">{{ m }}</div>
  {% endfor %}

  <div class="row g-4">
    {% for ev in events %}
      {% set pending = ev.countDemandesByStatus('pending') %}
      {% set accepted = ev.countDemandesByStatus('accepted') %}
      {% set refused = ev.countDemandesByStatus('refused') %}

      <div class="col-12 col-md-6 col-lg-4">
        <div class="card shadow-sm border-0 h-100">
          {% if ev.imageCouvertureEvent %}
            <img src="{{ ev.imageCouvertureEvent }}" class="card-img-top" style="height:170px; object-fit:cover;" alt="cover">
          {% endif %}

          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <h5 class="card-title mb-2">{{ ev.titreEvent }}</h5>
              {% if pending > 0 %}
                <span class="badge bg-warning text-dark">Pending {{ pending }}</span>
              {% else %}
                <span class="badge bg-success">OK</span>
              {% endif %}
            </div>

            <div class="text-muted small mb-2">
              <i class="bi bi-geo-alt"></i> {{ ev.villeEvent }} — {{ ev.nomLieuEvent }}
            </div>

            <div class="text-muted small mb-3">
              <i class="bi bi-calendar-event"></i>
              {{ ev.dateDebutEvent|date('d/m/Y') }} → {{ ev.dateFinEvent|date('d/m/Y') }}
            </div>

            <div class="d-flex gap-2 flex-wrap mb-3">
              <span class="badge bg-info text-dark">Acceptés: {{ accepted }}</span>
              <span class="badge bg-secondary">Refusés: {{ refused }}</span>
              {% if ev.nbParticipantsMaxEvent is not null %}
                <span class="badge bg-dark">Max: {{ ev.nbParticipantsMaxEvent }}</span>
              {% endif %}
            </div>

            <a href="{{ path('admin_evenement_demandes_show', {id: ev.id}) }}" class="btn btn-primary btn-sm">
              Gérer les demandes
            </a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

</div>
{% endblock %}
